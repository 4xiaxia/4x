# AIClient-2-API éƒ¨ç½²é…ç½®æŒ‡å—

## ğŸ“‹ ç›®å½•

- [å¿«é€Ÿå¼€å§‹](#å¿«é€Ÿå¼€å§‹)
- [ç¯å¢ƒå˜é‡é…ç½®](#ç¯å¢ƒå˜é‡é…ç½®)
- [ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²](#ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²)
- [å®‰å…¨é…ç½®](#å®‰å…¨é…ç½®)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [æ•…éšœæ’æŸ¥](#æ•…éšœæ’æŸ¥)

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹å¼ä¸€ï¼šä¸€é”®éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# 1. å…‹éš†ä»“åº“
git clone https://github.com/4xiaxia/4x.git
cd 4x

# 2. å¤åˆ¶ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶
cp .env.example .env

# 3. ç¼–è¾‘ .env æ–‡ä»¶ï¼Œé…ç½®å¿…è¦çš„ç¯å¢ƒå˜é‡
nano .env

# 4. è¿è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬
bash ä¸€é”®éƒ¨ç½².sh
```

### æ–¹å¼äºŒï¼šæ‰‹åŠ¨éƒ¨ç½²

```bash
# 1. å®‰è£…ä¾èµ–
npm install

# 2. é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env

# 3. å¯åŠ¨æœåŠ¡
node src/core/master.js
```

---

## ğŸ”§ ç¯å¢ƒå˜é‡é…ç½®

### å¿…éœ€é…ç½®é¡¹

| å˜é‡å | è¯´æ˜ | ç¤ºä¾‹å€¼ | æ˜¯å¦å¿…éœ€ |
|--------|------|--------|----------|
| `DEFAULT_PASSWORD` | ç™»å½•å¯†ç  | `MySecureP@ssw0rd!2024` | âœ… æ˜¯ |
| `SERVER_PORT` | æœåŠ¡ç«¯å£ | `3000` | âŒ å¦ï¼ˆé»˜è®¤ 3000ï¼‰ |

### è®¤è¯é…ç½®

```bash
# ç™»å½•å¯†ç ï¼ˆå¿…éœ€ï¼‰
DEFAULT_PASSWORD=ä½ çš„å¼ºå¯†ç 

# API å¯†é’¥ï¼ˆå¯é€‰ï¼Œç”¨äº API è®¿é—®æ§åˆ¶ï¼‰
REQUIRED_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxx

# CORS æ¥æºé™åˆ¶ï¼ˆå¯é€‰ï¼Œç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
ALLOWED_ORIGINS=https://yourdomain.com,https://app.yourdomain.com
```

### AI æ¨¡å‹é…ç½®

#### Google Gemini é…ç½®

```bash
# Gemini OAuth é…ç½®
GEMINI_OAUTH_CLIENT_ID=your-client-id.apps.googleusercontent.com
GEMINI_OAUTH_CLIENT_SECRET=GOCSPX-xxxxxxxxxxxx

# ä»£ç†é…ç½®ï¼ˆå¦‚æœéœ€è¦ï¼‰
HTTP_PROXY=http://proxy-server:port
HTTPS_PROXY=http://proxy-server:port
```

**è·å– Google OAuth å‡­è¯æ­¥éª¤ï¼š**

1. è®¿é—® [Google Cloud Console](https://console.cloud.google.com/)
2. åˆ›å»ºæˆ–é€‰æ‹©ä¸€ä¸ªé¡¹ç›®
3. è¿›å…¥ "APIs & Services" â†’ "Credentials"
4. ç‚¹å‡» "Create Credentials" â†’ "OAuth client ID"
5. é€‰æ‹©åº”ç”¨ç±»å‹ä¸º "Web application"
6. æ·»åŠ å·²æˆæƒçš„é‡å®šå‘ URIï¼š`http://localhost:8085/callback`
7. å¤åˆ¶ Client ID å’Œ Client Secret

#### OpenAI é…ç½®

```bash
# OpenAI API é…ç½®
OPENAI_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxx
OPENAI_BASE_URL=https://api.openai.com/v1
```

#### Claude é…ç½®

```bash
# Claude API é…ç½®
CLAUDE_API_KEY=sk-ant-xxxxxxxxxxxxxxxxxxxxx
CLAUDE_BASE_URL=https://api.anthropic.com
```

---

## ğŸ¢ ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²

### 1. ç³»ç»Ÿè¦æ±‚

- **æ“ä½œç³»ç»Ÿ**: Linux (Ubuntu 20.04+, CentOS 7+, Debian 10+)
- **Node.js**: 18.x æˆ–æ›´é«˜ç‰ˆæœ¬
- **å†…å­˜**: è‡³å°‘ 1GB RAM
- **ç£ç›˜**: è‡³å°‘ 1GB å¯ç”¨ç©ºé—´
- **ç½‘ç»œ**: æ”¯æŒè®¿é—® AI æœåŠ¡å•† API

### 2. å®‰è£… Node.js

```bash
# ä½¿ç”¨ NVM å®‰è£…ï¼ˆæ¨èï¼‰
curl -o- https://raw.githubusercontent.com/nvm-sh/nvm/v0.39.0/install.sh | bash
source ~/.bashrc
nvm install 20
nvm use 20
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

```bash
# å¤åˆ¶é…ç½®æ–‡ä»¶
cp .env.example .env

# ç¼–è¾‘é…ç½®
nano .env
```

**ç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½®ï¼š**

```bash
# å®‰å…¨é…ç½®
DEFAULT_PASSWORD=éå¸¸å¼ºçš„å¯†ç ï¼ˆè‡³å°‘16ä½ï¼‰
REQUIRED_API_KEY=sk-éšæœºç”Ÿæˆçš„å¯†é’¥
ALLOWED_ORIGINS=https://yourdomain.com

# æœåŠ¡å™¨é…ç½®
SERVER_PORT=3000
SERVER_HOST=127.0.0.1  # ä»…ç›‘å¬æœ¬åœ°ï¼Œé…åˆ Nginx ä½¿ç”¨

# æ—¥å¿—é…ç½®
LOG_LEVEL=warn
LOG_OUTPUT_MODE=file
LOG_DIR=/var/log/aiclient-api

# æ€§èƒ½é…ç½®
MAX_CONNECTIONS=200
REQUEST_TIMEOUT=60000
```

### 4. ä½¿ç”¨ PM2 éƒ¨ç½²ï¼ˆæ¨èï¼‰

```bash
# å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨æœåŠ¡
pm2 start src/core/master.js --name "aiclient-api" --env production

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

**PM2 é…ç½®æ–‡ä»¶ç¤ºä¾‹** (`ecosystem.config.js`):

```javascript
module.exports = {
  apps: [{
    name: 'aiclient-api',
    script: './src/core/master.js',
    instances: 1,
    exec_mode: 'fork',
    env: {
      NODE_ENV: 'production',
      SERVER_PORT: 3000,
    },
    error_file: '/var/log/aiclient-api/error.log',
    out_file: '/var/log/aiclient-api/out.log',
    log_date_format: 'YYYY-MM-DD HH:mm:ss Z',
    merge_logs: true,
    autorestart: true,
    max_restarts: 10,
    min_uptime: '10s',
    max_memory_restart: '500M',
  }]
};
```

### 5. é…ç½® Nginx åå‘ä»£ç†

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # é‡å®šå‘åˆ° HTTPS
    return 301 https://$server_name$request_uri;
}

server {
    listen 443 ssl http2;
    server_name your-domain.com;

    # SSL è¯ä¹¦é…ç½®
    ssl_certificate /path/to/fullchain.pem;
    ssl_certificate_key /path/to/privkey.pem;

    # SSL å®‰å…¨é…ç½®
    ssl_protocols TLSv1.2 TLSv1.3;
    ssl_ciphers HIGH:!aNULL:!MD5;
    ssl_prefer_server_ciphers on;

    # æ—¥å¿—
    access_log /var/log/nginx/aiclient-api-access.log;
    error_log /var/log/nginx/aiclient-api-error.log;

    # åå‘ä»£ç†é…ç½®
    location / {
        proxy_pass http://127.0.0.1:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        proxy_cache_bypass $http_upgrade;
        proxy_connect_timeout 60s;
        proxy_send_timeout 60s;
        proxy_read_timeout 60s;
    }

    # é™æ€æ–‡ä»¶ç¼“å­˜
    location /static/ {
        proxy_pass http://127.0.0.1:3000/static/;
        expires 7d;
        add_header Cache-Control "public, immutable";
    }
}
```

### 6. é…ç½®é˜²ç«å¢™

```bash
# Ubuntu/Debian
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# CentOS/RHEL
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

---

## ğŸ”’ å®‰å…¨é…ç½®

### 1. å¯†ç å®‰å…¨

- âœ… ä½¿ç”¨è‡³å°‘ 16 ä½å¼ºå¯†ç 
- âœ… åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦
- âœ… å®šæœŸæ›´æ¢å¯†ç ï¼ˆå»ºè®®æ¯ 90 å¤©ï¼‰
- âŒ ä¸è¦ä½¿ç”¨é»˜è®¤å¯†ç  `admin123`

**ç”Ÿæˆå¼ºå¯†ç ç¤ºä¾‹ï¼š**

```bash
# ä½¿ç”¨ openssl ç”Ÿæˆ
openssl rand -base64 24

# ä½¿ç”¨ /dev/urandom ç”Ÿæˆ
cat /dev/urandom | tr -dc 'a-zA-Z0-9!@#$%^&*()' | fold -w 24 | head -n 1
```

### 2. API å¯†é’¥ç®¡ç†

- âœ… ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥
- âœ… å®šæœŸè½®æ¢ API å¯†é’¥
- âœ… é™åˆ¶å¯†é’¥æƒé™
- âŒ ä¸è¦åœ¨ä»£ç ä¸­ç¡¬ç¼–ç å¯†é’¥

### 3. ç½‘ç»œå®‰å…¨

- âœ… å¯ç”¨ HTTPS
- âœ… é…ç½® CORS ç™½åå•
- âœ… ä½¿ç”¨é˜²ç«å¢™é™åˆ¶è®¿é—®
- âœ… é…ç½®é€Ÿç‡é™åˆ¶ï¼ˆNginxï¼‰

**Nginx é€Ÿç‡é™åˆ¶é…ç½®ï¼š**

```nginx
# åœ¨ http å—ä¸­æ·»åŠ 
limit_req_zone $binary_remote_addr zone=api_limit:10m rate=10r/s;

# åœ¨ location å—ä¸­æ·»åŠ 
limit_req zone=api_limit burst=20 nodelay;
```

### 4. æ—¥å¿—å®‰å…¨

- âœ… å®šæœŸæ¸…ç†æ—¥å¿—æ–‡ä»¶
- âœ… æ•æ„Ÿä¿¡æ¯ä¸è®°å½•åˆ°æ—¥å¿—
- âœ… æ—¥å¿—æ–‡ä»¶æƒé™è®¾ç½®ä¸º 600

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. è°ƒæ•´è¿æ¥æ± é…ç½®

```bash
# æ ¹æ®æœåŠ¡å™¨æ€§èƒ½è°ƒæ•´
MAX_CONNECTIONS=100  # ä½é…æœåŠ¡å™¨å»ºè®® 50-100
MAX_CONNECTIONS=200  # ä¸­é…æœåŠ¡å™¨å»ºè®® 100-200
MAX_CONNECTIONS=500  # é«˜é…æœåŠ¡å™¨å»ºè®® 200-500
```

### 2. å¯ç”¨ç¼“å­˜

```bash
# å¯ç”¨æ—¥å¿—æ–‡ä»¶ç¼“å­˜
LOG_MAX_FILE_SIZE=104857600  # 100MB
LOG_MAX_FILES=5
```

### 3. ä½¿ç”¨å¤šè¿›ç¨‹

```bash
# ä½¿ç”¨ PM2 é›†ç¾¤æ¨¡å¼
pm2 start src/core/master.js -i max
```

### 4. ç›‘æ§å’Œå‘Šè­¦

æ¨èä½¿ç”¨ä»¥ä¸‹ç›‘æ§å·¥å…·ï¼š
- **PM2 Plus**: åº”ç”¨æ€§èƒ½ç›‘æ§
- **Grafana + Prometheus**: ç³»ç»Ÿç›‘æ§
- **ELK Stack**: æ—¥å¿—åˆ†æ

---

## ğŸ” æ•…éšœæ’æŸ¥

### 1. æœåŠ¡æ— æ³•å¯åŠ¨

**æ£€æŸ¥ç«¯å£å ç”¨ï¼š**
```bash
lsof -i :3000
# æˆ–
netstat -tunlp | grep 3000
```

**æ£€æŸ¥æ—¥å¿—ï¼š**
```bash
tail -f logs/app-$(date +%Y-%m-%d).log
```

### 2. API è¯·æ±‚å¤±è´¥

**æ£€æŸ¥ç¯å¢ƒå˜é‡ï¼š**
```bash
# æŸ¥çœ‹æ‰€æœ‰ç¯å¢ƒå˜é‡
env | grep -E "API_KEY|CLIENT_ID|CLIENT_SECRET"

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat .env
```

**æµ‹è¯•ç½‘ç»œè¿æ¥ï¼š**
```bash
curl -I https://api.openai.com
curl -I https://api.anthropic.com
```

### 3. è®¤è¯å¤±è´¥

**éªŒè¯å¯†ç æ–‡ä»¶ï¼š**
```bash
# å¦‚æœä½¿ç”¨å¯†ç æ–‡ä»¶
cat configs/pwd

# ç¡®ä¿å¯†ç æ­£ç¡®
curl -X POST http://localhost:3000/api/login \
  -H "Content-Type: application/json" \
  -d '{"password":"your-password"}'
```

### 4. OAuth è®¤è¯é—®é¢˜

**æ£€æŸ¥ä»£ç†é…ç½®ï¼š**
```bash
# æµ‹è¯•ä»£ç†
curl -x http://proxy-server:port https://www.googleapis.com

# éªŒè¯ç¯å¢ƒå˜é‡
echo $HTTP_PROXY
echo $HTTPS_PROXY
```

### 5. æ€§èƒ½é—®é¢˜

**æ£€æŸ¥èµ„æºä½¿ç”¨ï¼š**
```bash
# CPU å’Œå†…å­˜
top -p $(pgrep -f "node src/core/master.js")

# ç£ç›˜ä½¿ç”¨
df -h

# ç½‘ç»œè¿æ¥
netstat -an | grep 3000 | wc -l
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **æ–‡æ¡£**: æŸ¥çœ‹é¡¹ç›® README.md
- **Issues**: https://github.com/4xiaxia/4x/issues
- **ç¤¾åŒº**: æ¬¢è¿æäº¤ PR å’Œ Issue

---

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨ MIT è®¸å¯è¯ã€‚è¯¦è§ LICENSE æ–‡ä»¶ã€‚

---

**æœ€åæ›´æ–°**: 2026-02-15
**ç‰ˆæœ¬**: 1.0.0
